(()=>{"use strict";const e={forest:"Лес",negative:"Негатив",work:"Работа",money:"Деньги",water:"Влага",wind:"Ветер",tester:"Тестировщик",pivko:"Пив&ко",anton:"Антоша",ants:"Муравьи",cigarettes:"Сигареты",dm:"Дядя Миша",dm_dead:"Мертвый Дядя Миша",dm_dead_eight:"Восемь мертвых Дядей Миш",dm_dead_four:"Четвыре мертвых Дяди Мишей",dm_dead_six:"Шесть мертвых Дядей Миш",dm_dead_two:"Два метрвых Дяди Миши",dm_dressed:"Одетый Дядя Миша",dm_wet:"Влажный Дядя Миша",persimmon:"Хурма",persimmon_with_ants:"Хурма с муравьями",portal:"Портвл в Ад",wolf:"Волк",wolf_two:"Два волка",wolf_four:"Четыре волка",blob:"Blob",lobster:"Лобствер",blobster:"Блобстер",frog:"Жаба",il_blob:"Илюха Блобстер",wolfpack_1:"Дядя Миша и три волка",wolfpack_2:"Антоша, Дядя миша и два волка",wolfpack_3:"Блобстер, Антоша, Дядя миша и волк",wolfpack_4:"Стая",victory:"Победа",online_prince:"Онлайн-принц",anton_anteater:"Антоша Муравьед",calculator:"Калькулятор",beer:"Пиво",beer_alkofree:"Безалкогольное пиво",minus:"Минус",1230:"12:30",food:"Еда",plain:"Поле",island:"Остров",gay_island:"Гей-Остров",kal:"Кал",hat:"Шапка",ad:"АД",calculator_prince:"Принц-калькулятор",lemon:"Лемон",lemongrass:"Лемограс",minus_lemongrass:"Минус лемонграс",apple:"Яблочко",double_apple:"Двойное яблочко",dust:"Смесь",powered_kal:"Заряженный кал",minus_love:"Минус любовь",love:"Любовь",dm_sad:"Грустный ДМ",dm_happy:"Счастилвый ДМ",evil:"Зло",booblick:"Бублик",underground_parking:"Поздемная парковка",car:"Машина",oval:"Овал",orden:"Орден",ovalolikiy:"Овалоликий",much_money:"Много денег",cross:"Крест",crusader:"Крестоносец",ogr:"Огрызок"},t={negative:4,calculator:5,powered_kal:7},s={};for(let o in e)if(t[o]){const e=[];for(let s=0;s<t[o];s++){const t=new Image;t.src=`./images/${o}_${s}.png`,e.push(t)}s[o]=e}else{const e=new Image;e.src=`./images/${o}.png`,s[o]=e}const o=document.getElementById("canvas"),i=800;o.width=i,o.height=800;let n=!1;document.getElementById("show-count-left").onchange=e=>n=e.target.checked;const d=document.getElementById("found-element");function l(t,o){const i=document.createElement("div");i.style.position="relative";const n=function(e){const t=s[e];return Array.isArray(t)?t[0]:t}(t);n.style.width=`${r}px`,n.style.height=`${r}px`,i.appendChild(n);const l=document.createElement("span");l.innerText=e[t],l.style.position="absolute",l.style.left="0",l.style.top=`${r}px`,l.style.fontSize="12px",i.appendChild(l),i.onclick=()=>o(t),i.ontouchstart=()=>o(t),d.appendChild(i)}const r=64,c=new class{constructor(e){this.field=[],this.recipies=e,this.selectedItem=null,this.leftRecipiesCountMap={},this.found=new Set,o.addEventListener("mousedown",this.handleOnClick.bind(this)),o.addEventListener("mousemove",this.handleMove.bind(this)),o.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),o.addEventListener("mouseup",this.handleMouseLeave.bind(this)),o.addEventListener("touchstart",this.handleOnTouch.bind(this)),o.addEventListener("touchmove",this.handleTouchMove.bind(this)),o.addEventListener("touchend",this.handleMouseLeave.bind(this)),this.ctx=o.getContext("2d"),this.tick=0,setInterval(this.draw.bind(this),40)}spawnElement(e){const t=Math.random()*(i-r),s=Math.random()*(800-r);this.field.push({id:e,x:t,y:s})}discoverRecpie(t){const s=this.recipies.find((e=>e.result===t));this.leftRecipiesCountMap[s.first]--,s.first!==s.second&&this.leftRecipiesCountMap[s.second]--,l(t,this.spawnElement.bind(this));const o=document.createElement("p");o.innerText=`${e[s.first]} + ${e[s.second]} = ${e[s.result]}`,document.getElementById("recipies").appendChild(o)}load(e,t){console.log("Loaded"),console.log(e),this.field=e,this.found=t,this.leftRecipiesCountMap={};for(let e of this.recipies)this.leftRecipiesCountMap[e.first]=this.leftRecipiesCountMap[e.first]?this.leftRecipiesCountMap[e.first]+1:1,this.leftRecipiesCountMap[e.second]=this.leftRecipiesCountMap[e.second]?this.leftRecipiesCountMap[e.second]+1:1;l("water",this.spawnElement.bind(this)),l("wind",this.spawnElement.bind(this)),l("negative",this.spawnElement.bind(this)),l("work",this.spawnElement.bind(this));for(let e of t)this.discoverRecpie(e)}draw(){this.tick=(this.tick+1)%100,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,i,i),this.ctx.fillStyle="black";for(let t of this.field){const o=s[t.id],i=Array.isArray(o)?o[Math.floor(.2*this.tick)%o.length]:o;this.ctx.drawImage(i,t.x,t.y),this.ctx.fillText(e[t.id],t.x,t.y+r+12),n&&this.ctx.fillText((this.leftRecipiesCountMap[t.id]||0).toString(),t.x,t.y+r+24)}}handleMove(e){if(!this.selectedItem)return;const t=this.getMousePosition(e);this.selectedItem.x=t.x-r/2,this.selectedItem.y=t.y-r/2}handleTouchMove(e){if(!this.selectedItem)return;const t=this.getTouchPosition(e);this.selectedItem.x=t.x-r/2,this.selectedItem.y=t.y-r/2}handleMouseLeave(){if(this.selectedItem){e:for(let e of this.field)if(e!==this.selectedItem&&!(e.x+r<=this.selectedItem.x||this.selectedItem.x+r<e.x||e.y+r<this.selectedItem.y||this.selectedItem.y+r<e.y)){console.log(`Found intersection with ${e.id}`);for(let t of this.recipies)if(t.first===this.selectedItem.id&&t.second===e.id||t.second===this.selectedItem.id&&t.first===e.id){this.found.has(t.result)||(this.found.add(t.result),this.discoverRecpie(t.result)),this.field=this.field.filter((t=>t!==e&&t!==this.selectedItem)),this.field.push({x:this.selectedItem.x,y:this.selectedItem.y,id:t.result});break e}}this.selectedItem=null}}handleOnClick(e){const t=this.getMousePosition(e);console.log(t);for(let e of this.field)if(e.x<=t.x&&e.x+r>=t.x&&e.y<=t.y&&e.y+r>=t.y){this.selectedItem=e;break}}handleOnTouch(e){const t=this.getTouchPosition(e);console.log(t);for(let e of this.field)if(e.x<=t.x&&e.x+r>=t.x&&e.y<=t.y&&e.y+r>=t.y){this.selectedItem=e;break}}getTouchPosition(e){const t=o.getBoundingClientRect();return{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}}getMousePosition(e){const t=o.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}}([{first:"negative",second:"work",result:"money"},{first:"wind",second:"money",result:"tester"},{first:"money",second:"water",result:"pivko"},{first:"dm",second:"water",result:"dm_wet"},{first:"dm_wet",second:"wind",result:"dm_dead"},{first:"tester",second:"work",result:"persimmon"},{first:"tester",second:"forest",result:"ants"},{first:"persimmon",second:"ants",result:"persimmon_with_ants"},{first:"work",second:"water",result:"forest"},{first:"cigarettes",second:"tester",result:"anton"},{first:"negative",second:"hat",result:"dm"},{first:"ants",second:"persimmon",result:"persimmon_with_ants"},{first:"money",second:"pivko",result:"cigarettes"},{first:"dm_dead_six",second:"dm_dead_four",result:"portal"},{first:"dm_dead_eight",second:"dm_dead_two",result:"portal"},{first:"dm_dead",second:"dm_dead",result:"dm_dead_two"},{first:"dm_dead_two",second:"dm_dead_two",result:"dm_dead_four"},{first:"dm_dead_two",second:"dm_dead_four",result:"dm_dead_six"},{first:"dm_dead_six",second:"dm_dead_two",result:"dm_dead_eight"},{first:"dm_dead_four",second:"dm_dead_four",result:"dm_dead_eight"},{first:"forest",second:"negative",result:"wolf"},{first:"wolf",second:"wolf",result:"wolf_two"},{first:"wolf_two",second:"wolf_two",result:"wolf_four"},{first:"wolf_four",second:"dm",result:"wolfpack_1"},{first:"wolfpack_1",second:"anton_anteater",result:"wolfpack_2"},{first:"wolfpack_2",second:"il_blob",result:"wolfpack_3"},{first:"wolfpack_3",second:"ad",result:"wolfpack_4"},{first:"wolfpack_4",second:"evil",result:"victory"},{first:"anton",second:"persimmon_with_ants",result:"anton_anteater"},{first:"negative",second:"money",result:"online_prince"},{first:"money",second:"work",result:"blob"},{first:"blob",second:"lobster",result:"blobster"},{first:"forest",second:"water",result:"frog"},{first:"frog",second:"water",result:"lobster"},{first:"blobster",second:"frog",result:"il_blob"},{first:"blob",second:"money",result:"calculator"},{first:"calculator",second:"money",result:"minus"},{first:"pivko",second:"water",result:"beer"},{first:"beer",second:"minus",result:"beer_alkofree"},{first:"work",second:"minus",result:"1230"},{first:"work",second:"1230",result:"food"},{first:"forest",second:"wind",result:"plain"},{first:"plain",second:"water",result:"island"},{first:"island",second:"beer_alkofree",result:"gay_island"},{first:"gay_island",second:"food",result:"kal"},{first:"calculator",second:"online_prince",result:"calculator_prince"},{first:"calculator_prince",second:"portal",result:"ad"},{first:"negative",second:"wind",result:"hat"},{first:"forest",second:"food",result:"apple"},{first:"island",second:"food",result:"lemon"},{first:"lemon",second:"plain",result:"lemongrass"},{first:"lemongrass",second:"minus",result:"minus_lemongrass"},{first:"apple",second:"apple",result:"double_apple"},{first:"double_apple",second:"minus_lemongrass",result:"dust"},{first:"dust",second:"kal",result:"powered_kal"},{first:"powered_kal",second:"dm",result:"love"},{first:"love",second:"minus",result:"minus_love"},{first:"dm",second:"beer_alkofree",result:"dm_happy"},{first:"minus_love",second:"dm_happy",result:"dm_sad"},{first:"cross",second:"dm_sad",result:"crusader"},{first:"money",second:"money",result:"much_money"},{first:"much_money",second:"anton",result:"car"},{first:"car",second:"anton",result:"oval"},{first:"oval",second:"anton",result:"ovalolikiy"},{first:"ovalolikiy",second:"crusader",result:"orden"},{first:"orden",second:"booblick",result:"evil"},{first:"car",second:"work",result:"underground_parking"},{first:"underground_parking",second:"negative",result:"booblick"},{first:"minus",second:"minus",result:"cross"},{first:"anton",second:"apple",result:"ogr"}]);c.load([{x:200,y:400,id:"water"},{x:300,y:400,id:"wind"},{x:400,y:400,id:"negative"},{x:500,y:400,id:"work"}],new Set),function(e){const t=document.getElementById("save-button"),s=document.getElementById("load-button"),o="alchemy-save";s.disabled=!window.localStorage.getItem(o),t.onclick=function(){const t={fields:e.field,found:[...e.found]};window.localStorage.setItem(o,JSON.stringify(t)),s.disabled=!1},s.onclick=function(){const t=JSON.parse(window.localStorage.getItem(o)),s=t.fields,i=new Set(t.found);e.load(s,i)}}(c),document.getElementById("clear-button").onclick=()=>c.field=[]})();