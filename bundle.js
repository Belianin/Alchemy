(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{c:()=>c});const t={forest:"Лес",negative:"Негатив",work:"Работа",money:"Деньги",water:"Влага",wind:"Ветер",tester:"Тестировщик",pivko:"Пив&ко",anton:"Антоша",ants:"Муравьи",cigarettes:"Сигареты",dm:"Дядя Миша",dm_dead:"Мертвый Дядя Миша",dm_dead_eight:"Восемь мертвых Дядей Миш",dm_dead_four:"Четвыре мертвых Дяди Мишей",dm_dead_six:"Шесть мертвых Дядей Миш",dm_dead_two:"Два метрвых Дяди Миши",dm_dressed:"Одетый Дядя Миша",dm_wet:"Влажный Дядя Миша",persimmon:"Хурма",persimmon_with_ants:"Хурма с муравьями",portal:"Портвл в Ад",wolf:"Волк",wolf_two:"Два волка",wolf_four:"Четыре волка",blob:"Blob",lobster:"Лобстер",blobster:"Блобстер",frog:"Жаба",il:"Илюша",il_sleep:"Илюша спит",il_blob:"Илюха Блобстер",dream:"Сон",hot_sause:"Острый соус",nightmare_potion:"Зелье кошмаров",wolfpack_1:"Дядя Миша и три волка",wolfpack_2:"Антоша, Дядя миша и два волка",wolfpack_3:"Блобстер, Антоша, Дядя миша и волк",wolfpack_4:"Стая",victory:"Победа",online_prince:"Онлайн-принц",anton_anteater:"Антоша Муравьед",calculator:"Калькулятор",beer:"Пиво",beer_alkofree:"Безалкогольное пиво",minus:"Минус",1230:"12:30",food:"Еда",plain:"Поле",island:"Остров",gay_island:"Гей-Остров",kal:"Кал",hat:"Шапка",ad:"АД",calculator_prince:"Принц-калькулятор",lemon:"Лемон",lemongrass:"Лемограс",minus_lemongrass:"Минус лемонграс",apple:"Яблочко",double_apple:"Двойное яблочко",dust:"Смесь",powered_kal:"Заряженный кал",minus_love:"Минус любовь",love:"Любовь",dm_sad:"Грустный ДМ",dm_happy:"Счастилвый ДМ",evil:"Зло",booblick:"Бублик",underground_parking:"Поздемная парковка",car:"Машина",oval:"Овал",orden:"Орден",ovalolikiy:"Овалоликий",much_money:"Много денег",cross:"Крест",crusader:"Крестоносец",ogr:"Огрызок",balance:"Баланс",positive:"Позитив",tea_goblin:"Чайный гоблин",universe:"Вселенная",tulpa:"Тульпа",soul:"Душа",ears:"Уши!",dm_with_tea:"ДМ с чаем",cups_of_tea:"Много чая",cup_of_tea:"Кружка чая",cup_of_water:"Кружка воды",cup:"Кружка",panama:"Панама",perm_pasport:"Паспорт пермяка",tea:"Чай",mountains:"Горы",nagorny:"Нагорный",real_work:"Настоящая работа",stones:"Камни",hammer:"Молоток",booblic_with_ears:"Бублик с ушами",tire:"Колесо",minecraft:"Майнкрафт",castle:"Замок",tire_keeper:"Хранитель Диска",tavern:"Таверна",mine:"Шахта",dm_buddha:"Будда",fingerprint:"Отпечаток",police:"Полиция",penalty:"Штраф",few_money:"Мало денег",mashed_apple:"Яблоко всмятку",pie:"Пирог",tea_with_pie:"Чай с пирогами",music:"Музыка",rep:"Репбаза",rep_people:"Люди на репбазе",band:"Группа",pchsp:"Настоящая группа","3-7":"Три топора",1:"1",4:"4","4+":"4+","4-":"4-",3:"3",33:"33",7:"7",77:"77","3-in-line":"Три-в-ряд",dark_fantasy:"Тёмное фентези",fantasy:"Фентези",wood:"Древесина",table:"Стол",boardgame:"Настольная игра",house:"Здание",it:"IT",knife:"Нож",rest:"Общепит",spider:"Паук",spiders:"Пауки",spiders_with_knifes:"Пауки с ножами",iron:"Железо",anton_cook:"Повар Антон",anton_cook_knife:"Мясник",dm_cook:"Повар ДМ",kitchen:"Кухня",band_zveri:"Звери",meat:"Мясо",meat_bublik:"Мясной бублик",dm_confused:"ДМ не понял",bag:"Мешок",swamp:"Болото",pool:"Бассейн",anton_hunter:"Антон охотник",anton_traveler:"Антон путешественник",dm_traveler:"ДМ путешественник",hotel:"Отель",city:"Город",duolingo:"Сова",dm_polyglot:"ДМ полиглот",knife_damask:"Дамасский нож",hat_swimming:"Шапочка",animals:"Животные",water_animals:"Водные животные",meat_bublik_live:"Живой мясной бублик",meat_bublik_live_demon:"Одержимый мясной бублик",antikaif:"НЕ КАЙФ",kaif:"Каиф",sword:"Меч",longsword:"Длинный меч",dm_armored:"ДМ в броне",dm_swordsman:"ДМ мечник",armor:"Броня",moon_and_stars:"Луна и звезды",dm_islam:"ДМ исламист",istambul:"Стамбул",bublik_phys:"Физическое воплощение Бублика",adventures_pro:"Прокаченные приключенцы",adventures:"Приключенцы",exp:"Опыт",exp_x2:"Двойной опыт",quest:"Квест",rats:"Крысы"},s={negative:4,calculator:5,powered_kal:7},i={};for(let e in t)if(s[e]){const t=[];for(let i=0;i<s[e];i++){const s=new Image;s.src=`./images/${e}_${i}.png`,t.push(s)}i[e]=t}else{const t=new Image;t.src=`./images/${e}.png`,i[e]=t}const o=[{first:"negative",second:"work",result:"money"},{first:"wind",second:"money",result:"tester"},{first:"money",second:"house",result:"pivko"},{first:"dm",second:"water",result:"dm_wet"},{first:"dm_wet",second:"wind",result:"dm_dead"},{first:"food",second:"it",result:"persimmon"},{first:"blob",second:"forest",result:"ants"},{first:"persimmon",second:"ants",result:"persimmon_with_ants"},{first:"wind",second:"water",result:"forest"},{first:"cigarettes",second:"tester",result:"anton"},{first:"negative",second:"hat",result:"dm"},{first:"money",second:"pivko",result:"cigarettes"},{first:"dm_dead_six",second:"dm_dead_four",result:"portal"},{first:"dm_dead_eight",second:"dm_dead_two",result:"portal"},{first:"dm_dead",second:"dm_dead",result:"dm_dead_two"},{first:"dm_dead_two",second:"dm_dead_two",result:"dm_dead_four"},{first:"dm_dead_two",second:"dm_dead_four",result:"dm_dead_six"},{first:"dm_dead_six",second:"dm_dead_two",result:"dm_dead_eight"},{first:"dm_dead_four",second:"dm_dead_four",result:"dm_dead_eight"},{first:"forest",second:"negative",result:"wolf"},{first:"wolf",second:"wolf",result:"wolf_two"},{first:"wolf_two",second:"wolf_two",result:"wolf_four"},{first:"wolf_four",second:"dm",result:"wolfpack_1"},{first:"wolfpack_1",second:"anton_anteater",result:"wolfpack_2"},{first:"wolfpack_2",second:"il_blob",result:"wolfpack_3"},{first:"wolfpack_3",second:"ad",result:"wolfpack_4"},{first:"dark_fantasy",second:"universe",result:"victory"},{first:"anton",second:"persimmon_with_ants",result:"anton_anteater"},{first:"negative",second:"money",result:"online_prince"},{first:"money",second:"it",result:"blob"},{first:"blob",second:"lobster",result:"blobster"},{first:"anton_hunter",second:"swamp",result:"frog"},{first:"anton_hunter",second:"forest",result:"duolingo"},{first:"anton_hunter",second:"island",result:"lobster"},{first:"water",second:"frog",result:"il"},{first:"negative",second:"water",result:"hot_sause"},{first:"hot_sause",second:"dream",result:"nightmare_potion"},{first:"nightmare_potion",second:"il",result:"il_sleep"},{first:"il",second:"it",result:"dream"},{first:"il_sleep",second:"blobster",result:"il_blob"},{first:"blob",second:"money",result:"calculator"},{first:"calculator",second:"money",result:"minus"},{first:"pivko",second:"water",result:"beer"},{first:"beer",second:"minus",result:"beer_alkofree"},{first:"it",second:"minus",result:"1230"},{first:"it",second:"1230",result:"food"},{first:"forest",second:"wind",result:"plain"},{first:"plain",second:"water",result:"island"},{first:"island",second:"beer_alkofree",result:"gay_island"},{first:"gay_island",second:"food",result:"kal"},{first:"calculator",second:"online_prince",result:"calculator_prince"},{first:"calculator_prince",second:"portal",result:"ad"},{first:"negative",second:"wind",result:"hat"},{first:"forest",second:"food",result:"apple"},{first:"island",second:"food",result:"lemon"},{first:"lemon",second:"plain",result:"lemongrass"},{first:"lemongrass",second:"minus",result:"minus_lemongrass"},{first:"apple",second:"apple",result:"double_apple"},{first:"double_apple",second:"minus_lemongrass",result:"dust"},{first:"dust",second:"kal",result:"powered_kal"},{first:"powered_kal",second:"dm",result:"love"},{first:"love",second:"minus",result:"minus_love"},{first:"dm",second:"beer_alkofree",result:"dm_happy"},{first:"minus_love",second:"dm_happy",result:"dm_sad"},{first:"dm_sad",second:"armor",result:"dm_armored"},{first:"longsword",second:"dm_armored",result:"dm_swordsman"},{first:"cross",second:"dm_swordsman",result:"crusader"},{first:"money",second:"money",result:"much_money"},{first:"much_money",second:"anton",result:"car"},{first:"car",second:"anton",result:"oval"},{first:"oval",second:"anton",result:"ovalolikiy"},{first:"ovalolikiy",second:"tire_keeper",result:"adventures"},{first:"crusader",second:"tire",result:"tire_keeper"},{first:"mine",second:"work",result:"minecraft"},{first:"bublik_phys",second:"istambul",result:"evil"},{first:"meat_bublik_live_demon",second:"booblick",result:"bublik_phys"},{first:"car",second:"it",result:"underground_parking"},{first:"underground_parking",second:"negative",result:"booblick"},{first:"minus",second:"minus",result:"cross"},{first:"anton",second:"apple",result:"ogr"},{first:"police",second:"car",result:"penalty"},{first:"minus",second:"negative",result:"positive"},{first:"positive",second:"negative",result:"balance"},{first:"tulpa",second:"tea_goblin",result:"universe"},{first:"dm_dead",second:"dm_buddha",result:"soul"},{first:"balance",second:"fingerprint",result:"dm_buddha"},{first:"pivko",second:"anton",result:"police"},{first:"dm",second:"police",result:"fingerprint"},{first:"dm_with_tea",second:"ears",result:"tea_goblin"},{first:"hat",second:"island",result:"panama"},{first:"panama",second:"nagorny",result:"perm_pasport"},{first:"kal",second:"booblick",result:"cup"},{first:"cup",second:"water",result:"cup_of_water"},{first:"cup_of_tea",second:"cup_of_tea",result:"cups_of_tea"},{first:"cups_of_tea",second:"dm",result:"dm_with_tea"},{first:"dm",second:"pivko",result:"tea"},{first:"tea",second:"cup_of_water",result:"cup_of_tea"},{first:"mountains",second:"pivko",result:"nagorny"},{first:"perm_pasport",second:"anton",result:"ears"},{first:"house",second:"negative",result:"stones"},{first:"plain",second:"stones",result:"mountains"},{first:"booblick",second:"ears",result:"booblic_with_ears"},{first:"soul",second:"love",result:"tulpa"},{first:"pivko",second:"pchsp",result:"tavern"},{first:"mountains",second:"3-in-line",result:"mine"},{first:"orden",second:"mine",result:"castle"},{first:"work",second:"car",result:"tire"},{first:"penalty",second:"money",result:"few_money"},{first:"work",second:"apple",result:"mashed_apple"},{first:"mashed_apple",second:"food",result:"pie"},{first:"pie",second:"cup_of_tea",result:"tea_with_pie"},{first:"ears",second:"car",result:"music"},{first:"music",second:"few_money",result:"rep"},{first:"rep",second:"wolfpack_4",result:"rep_people"},{first:"rep_people",second:"3-7",result:"band"},{first:"band",second:"tea_with_pie",result:"pchsp"},{first:"calculator",second:"dm_dead_four",result:"4"},{first:"4",second:"cross",result:"4+"},{first:"4",second:"minus",result:"4-"},{first:"4-",second:"1",result:"3"},{first:"4+",second:"3",result:"7"},{first:"7",second:"7",result:"77"},{first:"77",second:"7",result:"3-7"},{first:"3",second:"3",result:"33"},{first:"33",second:"3",result:"3-in-line"},{first:"fantasy",second:"evil",result:"dark_fantasy"},{first:"tavern",second:"castle",result:"fantasy"},{first:"blob",second:"work",result:"1"},{first:"forest",second:"work",result:"wood"},{first:"wood",second:"work",result:"table"},{first:"table",second:"minecraft",result:"boardgame"},{first:"wood",second:"plain",result:"house"},{first:"house",second:"work",result:"it"},{first:"spider",second:"spider",result:"spiders"},{first:"spiders",second:"knife",result:"spiders_with_knifes"},{first:"spiders_with_knifes",second:"table",result:"kitchen"},{first:"house",second:"kitchen",result:"rest"},{first:"iron",second:"wood",result:"knife"},{first:"mountains",second:"work",result:"iron"},{first:"anton",second:"rest",result:"anton_cook"},{first:"anton_cook",second:"knife",result:"anton_cook_knife"},{first:"dm",second:"rest",result:"dm_cook"},{first:"band",second:"animals",result:"band_zveri"},{first:"anton_cook_knife",second:"band_zveri",result:"meat"},{first:"meat",second:"dm_cook",result:"meat_bublik"},{first:"ants",second:"negative",result:"spider"},{first:"bag",second:"dm",result:"dm_confused"},{first:"boardgame",second:"anton",result:"bag"},{first:"forest",second:"water",result:"swamp"},{first:"bag",second:"anton",result:"anton_traveler"},{first:"anton_traveler",second:"knife_damask",result:"anton_hunter"},{first:"knife",second:"hot_sause",result:"knife_damask"},{first:"house",second:"house",result:"city"},{first:"city",second:"car",result:"hotel"},{first:"hat",second:"water",result:"hat_swimming"},{first:"hotel",second:"hat_swimming",result:"pool"},{first:"dm_confused",second:"duolingo",result:"dm_polyglot"},{first:"dm_polyglot",second:"perm_pasport",result:"dm_traveler"},{first:"dm_traveler",second:"istambul",result:"dm_islam"},{first:"frog",second:"lobster",result:"water_animals"},{first:"water_animals",second:"duolingo",result:"animals"},{first:"pool",second:"powered_kal",result:"kaif"},{first:"kaif",second:"negative",result:"antikaif"},{first:"meat_bublik",second:"soul",result:"meat_bublik_live"},{first:"meat_bublik_live",second:"antikaif",result:"meat_bublik_live_demon"},{first:"much_money",second:"dm",result:"armor"},{first:"knife",second:"iron",result:"sword"},{first:"sword",second:"iron",result:"longsword"},{first:"animals",second:"ad",result:"rats"},{first:"rats",second:"tavern",result:"quest"},{first:"quest",second:"adventures",result:"exp"},{first:"exp",second:"duolingo",result:"exp_x2"},{first:"exp_x2",second:"adventures",result:"adventures_pro"},{first:"adventures_pro",second:"dm_islam",result:"orden"},{first:"moon_and_stars",second:"city",result:"istambul"},{first:"dream",second:"positive",result:"moon_and_stars"}],n=(e,t)=>!(e.x+c<=t.x||t.x+c<e.x||e.y+c<t.y||t.y+c<e.y),r=document.getElementById("canvas"),d=800;r.width=d,r.height=800;const l=document.getElementById("found-element");function a(e,s){const n=document.createElement("div");n.style.position="relative",n.className="found-element",n.id=`element-${e}`;const r=function(e){const t=i[e];return Array.isArray(t)?t[0]:t}(e);r.id=`${e}_img`,r.style.width=`${c}px`,r.style.height=`${c}px`,r.style.display="block",r.addEventListener("dragstart",(t=>{t.dataTransfer.setData("text/plain",e)})),n.appendChild(r);const d=document.createElement("span");d.innerText=t[e],d.style.fontSize="12px",n.appendChild(d),n.onclick=()=>s(e),n.ontouchstart=()=>s(e);const a=o.find((t=>t.result===e));if(a){n.className=(n.className||"")+" tooltip";const e=document.createElement("div");e.className="tooltiptext",e.innerText=(e=>`${t[e.first]} + ${t[e.second]} = ${t[e.result]}`)(a),n.appendChild(e)}l.appendChild(n)}const c=64,u=new class{constructor(e){this.field=[],this.recipies=e,this.selectedItem=null,this.leftRecipiesCountMap={},this.found=new Set,r.addEventListener("mousedown",this.handleOnClick.bind(this)),r.addEventListener("mousemove",this.handleMouseMove.bind(this)),r.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),r.addEventListener("mouseup",this.handleMouseLeave.bind(this)),r.addEventListener("touchstart",this.handleOnTouch.bind(this)),r.addEventListener("touchmove",this.handleTouchMove.bind(this)),r.addEventListener("touchend",this.handleMouseLeave.bind(this)),r.addEventListener("drop",this.handleDrop.bind(this)),r.addEventListener("dragover",(e=>{e.preventDefault()})),this.ctx=r.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.tick=0,setInterval(this.draw.bind(this),40)}handleDrop(e){e.preventDefault();const t=e.dataTransfer.getData("text/plain"),s=r.getBoundingClientRect(),i=e.clientX-s.left-c/2,o=e.clientY-s.top-c/2,n=this.spawnElement(t,i,o);this.selectedItem=n,this.handleMouseLeave()}spawnElement(e,t,s){const i={id:e,x:t=t||Math.random()*(d-c),y:s=s||Math.random()*(800-c)};return this.field.push(i),i}discoverRecpie(e){a(e,this.spawnElement.bind(this));const t=this.recipies.find((t=>t.result===e));this.leftRecipiesCountMap[t.first]--,t.first!==t.second&&this.leftRecipiesCountMap[t.second]--,0===this.leftRecipiesCountMap[t.first]&&document.getElementById(`element-${t.first}`)&&document.getElementById(`element-${t.first}`).classList.add("discovered"),0===this.leftRecipiesCountMap[t.second]&&document.getElementById(`element-${t.second}`)&&document.getElementById(`element-${t.second}`).classList.add("discovered")}load(e,t){console.log("Loaded"),console.log(e),this.field=e,this.found=t,this.leftRecipiesCountMap={};for(let e of this.recipies)e.first===e.second?this.leftRecipiesCountMap[e.first]=this.leftRecipiesCountMap[e.first]?this.leftRecipiesCountMap[e.first]+1:1:(this.leftRecipiesCountMap[e.first]=this.leftRecipiesCountMap[e.first]?this.leftRecipiesCountMap[e.first]+1:1,this.leftRecipiesCountMap[e.second]=this.leftRecipiesCountMap[e.second]?this.leftRecipiesCountMap[e.second]+1:1);a("water",this.spawnElement.bind(this)),a("wind",this.spawnElement.bind(this)),a("negative",this.spawnElement.bind(this)),a("work",this.spawnElement.bind(this));for(let e of t)this.discoverRecpie(e)}draw(){this.tick=(this.tick+1)%100,this.ctx.fillStyle="#fffbe0",this.ctx.fillRect(0,0,d,d),this.ctx.fillStyle="black";for(let e=this.field.length-1;e>=0;e--){const s=this.field[e],o=i[s.id],n=Array.isArray(o)?o[Math.floor(.2*this.tick)%o.length]:o;this.ctx.drawImage(n,s.x,s.y);const r=t[s.id],d=this.ctx.measureText(r),l=`${t[s.id]} ${this.leftRecipiesCountMap[s.id]||""}`;this.ctx.font="12px Consolas",this.ctx.fillText(l,s.x+(c/2-d.width/2),s.y+c+12)}}handleMouseMove(e){this.handleMove(e)}handleTouchMove(e){this.handleMove(e.touches[0])}handleMove(e){if(!this.selectedItem)return;const t=this.getPosition(e);this.selectedItem.x=t.x-c/2,this.selectedItem.y=t.y-c/2}handleMouseLeave(){if(!this.selectedItem)return;const e=this.tryFindRecipe();if(e){const[t,s]=e;this.found.has(s.result)||(this.found.add(s.result),this.discoverRecpie(s.result)),this.field=[{x:this.selectedItem.x,y:this.selectedItem.y,id:s.result},...this.field.filter((e=>e!==t&&e!==this.selectedItem))]}else this.field=[this.selectedItem,...this.field.filter((e=>e!=this.selectedItem))];this.selectedItem=null}tryFindRecipe(){for(let e of this.field){if(e===this.selectedItem||!n(e,this.selectedItem))continue;const t=this.canCraft(this.selectedItem.id,e.id);if(t)return[e,t]}}canCraft(e,t){return this.recipies.find((s=>s.first===t&&s.second===e||s.second===t&&s.first===e))}handleOnClick(e){this.handleClick(e)}handleOnTouch(e){this.handleClick(e.touches[0])}handleClick(e){const t=this.getPosition(e);console.log(t);for(let e of this.field)if(e.x<=t.x&&e.x+c>=t.x&&e.y<=t.y&&e.y+c>=t.y){this.selectedItem=e;break}}getPosition(e){const t=r.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}}(o);window.game=u,u.load([{x:200,y:368,id:"water"},{x:300,y:368,id:"wind"},{x:400,y:368,id:"negative"},{x:500,y:368,id:"work"}],new Set),function(e){const t=document.getElementById("save-button"),s=document.getElementById("load-button"),i="alchemy-save";s.disabled=!window.localStorage.getItem(i),t.onclick=function(){const t={fields:e.field,found:[...e.found]};window.localStorage.setItem(i,JSON.stringify(t)),s.disabled=!1},s.onclick=function(){const t=JSON.parse(window.localStorage.getItem(i)),s=t.fields,o=new Set(t.found);e.load(s,o)}}(u),document.getElementById("clear-button").onclick=()=>u.field=[]})();