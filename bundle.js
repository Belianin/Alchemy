(()=>{"use strict";const e={forest:"Лес",negative:"Негатив",work:"Работа",money:"Деньги",water:"Влага",wind:"Ветер",tester:"Тестировщик",pivko:"Пив&ко",anton:"Антоша",ants:"Муравьи",cigarettes:"Сигареты",dm:"Дядя Миша",dm_dead:"Мертвый Дядя Миша",dm_dead_eight:"Восемь мертвых Дядей Миш",dm_dead_four:"Четвыре мертвых Дяди Мишей",dm_dead_six:"Шесть мертвых Дядей Миш",dm_dead_two:"Два метрвых Дяди Миши",dm_dressed:"Одетый Дядя Миша",dm_wet:"Влажный Дядя Миша",persimmon:"Хурма",persimmon_with_ants:"Хурма с муравьями",portal:"Портвл в Ад",wolf:"Волк",wolf_two:"Два волка",wolf_four:"Четыре волка",blob:"Blob",lobster:"Лобствер",blobster:"Блобстер",frog:"Жаба",il:"Илюша",il_sleep:"Илюша спит",il_blob:"Илюха Блобстер",dream:"Сон",hot_sause:"Острый соус",nightmare_potion:"Зелье кошмаров",wolfpack_1:"Дядя Миша и три волка",wolfpack_2:"Антоша, Дядя миша и два волка",wolfpack_3:"Блобстер, Антоша, Дядя миша и волк",wolfpack_4:"Стая",victory:"Победа",online_prince:"Онлайн-принц",anton_anteater:"Антоша Муравьед",calculator:"Калькулятор",beer:"Пиво",beer_alkofree:"Безалкогольное пиво",minus:"Минус",1230:"12:30",food:"Еда",plain:"Поле",island:"Остров",gay_island:"Гей-Остров",kal:"Кал",hat:"Шапка",ad:"АД",calculator_prince:"Принц-калькулятор",lemon:"Лемон",lemongrass:"Лемограс",minus_lemongrass:"Минус лемонграс",apple:"Яблочко",double_apple:"Двойное яблочко",dust:"Смесь",powered_kal:"Заряженный кал",minus_love:"Минус любовь",love:"Любовь",dm_sad:"Грустный ДМ",dm_happy:"Счастилвый ДМ",evil:"Зло",booblick:"Бублик",underground_parking:"Поздемная парковка",car:"Машина",oval:"Овал",orden:"Орден",ovalolikiy:"Овалоликий",much_money:"Много денег",cross:"Крест",crusader:"Крестоносец",ogr:"Огрызок",balance:"Баланс",positive:"Позитив",tea_goblin:"Чайный гоблин",universe:"Вселенная",tulpa:"Тульпа",soul:"Душа",ears:"Уши!",dm_with_tea:"ДМ с чаем",cups_of_tea:"Много чая",cup_of_tea:"Кружка чая",cup_of_water:"Кружка воды",cup:"Кружка",panama:"Панама",perm_pasport:"Паспорт пермяка",tea:"Чай",mountains:"Горы",nagorny:"Нагорный",real_work:"Настоящая работа",stones:"Камни",hammer:"Молоток",booblic_with_ears:"Бублик с ушами",tire:"Колесо",minecraft:"Майнкрафт",castle:"Замок",tire_keeper:"Хранитель Диска",tavern:"Таверна",mine:"Шахта",buddha:"Будда",fingerprint:"Отпечаток",police:"Полиция",penalty:"Штраф",few_money:"Мало денег",mashed_apple:"Яблоко всмятку",pie:"Пирог",tea_with_pie:"Чай с пирогами",music:"Музыка",rep:"Репбаза",rep_people:"Люди на репбазе",band:"Группа",pchsp:"Настоящая группа","3-7":"Три топора",1:"1",4:"4","4+":"4+","4-":"4-",3:"3",33:"33",7:"7",77:"77","3-in-line":"Три-в-ряд",dark_fantasy:"Тёмное фентези",fantasy:"Фентези"},t={negative:4,calculator:5,powered_kal:7},s={};for(let i in e)if(t[i]){const e=[];for(let s=0;s<t[i];s++){const t=new Image;t.src=`./images/${i}_${s}.png`,e.push(t)}s[i]=e}else{const e=new Image;e.src=`./images/${i}.png`,s[i]=e}const i=document.getElementById("canvas"),o=800;i.width=o,i.height=800;const n=document.getElementById("found-element");function r(t,i){const o=document.createElement("div");o.style.position="relative";const r=function(e){const t=s[e];return Array.isArray(t)?t[0]:t}(t);r.id=`${t}_img`,r.style.width=`${l}px`,r.style.height=`${l}px`,o.appendChild(r);const d=document.createElement("span");d.innerText=e[t],d.style.position="absolute",d.style.left="0",d.style.top=`${l}px`,d.style.fontSize="12px",o.appendChild(d),o.onclick=()=>i(t),o.ontouchstart=()=>i(t),n.appendChild(o)}const l=64,d=new class{constructor(e){this.field=[],this.recipies=e,this.selectedItem=null,this.leftRecipiesCountMap={},this.found=new Set,i.addEventListener("mousedown",this.handleOnClick.bind(this)),i.addEventListener("mousemove",this.handleMouseMove.bind(this)),i.addEventListener("mouseleave",this.handleMouseLeave.bind(this)),i.addEventListener("mouseup",this.handleMouseLeave.bind(this)),i.addEventListener("touchstart",this.handleOnTouch.bind(this)),i.addEventListener("touchmove",this.handleTouchMove.bind(this)),i.addEventListener("touchend",this.handleMouseLeave.bind(this)),this.ctx=i.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.tick=0,setInterval(this.draw.bind(this),40)}spawnElement(e){const t=Math.random()*(o-l),s=Math.random()*(800-l);this.field.push({id:e,x:t,y:s})}discoverRecpie(t){r(t,this.spawnElement.bind(this));const s=this.recipies.find((e=>e.result===t));this.leftRecipiesCountMap[s.first]--,s.first!==s.second&&this.leftRecipiesCountMap[s.second]--,0===this.leftRecipiesCountMap[s.first]&&document.getElementById(`${s.first}_img`)&&(document.getElementById(`${s.first}_img`).style.opacity="0.2"),0===this.leftRecipiesCountMap[s.second]&&document.getElementById(`${s.second}_img`)&&(document.getElementById(`${s.second}_img`).style.opacity="0.2");const i=document.createElement("p");i.innerText=`${e[s.first]} + ${e[s.second]} = ${e[s.result]}`,document.getElementById("recipies").appendChild(i)}load(e,t){console.log("Loaded"),console.log(e),this.field=e,this.found=t,this.leftRecipiesCountMap={};for(let e of this.recipies)e.first===e.second?this.leftRecipiesCountMap[e.first]=this.leftRecipiesCountMap[e.first]?this.leftRecipiesCountMap[e.first]+1:1:(this.leftRecipiesCountMap[e.first]=this.leftRecipiesCountMap[e.first]?this.leftRecipiesCountMap[e.first]+1:1,this.leftRecipiesCountMap[e.second]=this.leftRecipiesCountMap[e.second]?this.leftRecipiesCountMap[e.second]+1:1);r("water",this.spawnElement.bind(this)),r("wind",this.spawnElement.bind(this)),r("negative",this.spawnElement.bind(this)),r("work",this.spawnElement.bind(this));for(let e of t)this.discoverRecpie(e)}draw(){this.tick=(this.tick+1)%100,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,o,o),this.ctx.fillStyle="black";for(let t of this.field){const i=s[t.id],o=Array.isArray(i)?i[Math.floor(.2*this.tick)%i.length]:i;this.ctx.drawImage(o,t.x,t.y),this.ctx.fillText(e[t.id],t.x,t.y+l+12),this.ctx.fillText((this.leftRecipiesCountMap[t.id]||0).toString(),t.x,t.y+l+24)}}handleMouseMove(e){this.handleMove(e)}handleTouchMove(e){this.handleMove(e.touches[0])}handleMove(e){if(!this.selectedItem)return;const t=this.getPosition(e);this.selectedItem.x=t.x-l/2,this.selectedItem.y=t.y-l/2}handleMouseLeave(){if(this.selectedItem){e:for(let e of this.field)if(e!==this.selectedItem&&!(e.x+l<=this.selectedItem.x||this.selectedItem.x+l<e.x||e.y+l<this.selectedItem.y||this.selectedItem.y+l<e.y)){console.log(`Found intersection with ${e.id}`);for(let t of this.recipies)if(t.first===this.selectedItem.id&&t.second===e.id||t.second===this.selectedItem.id&&t.first===e.id){this.found.has(t.result)||(this.found.add(t.result),this.discoverRecpie(t.result)),this.field=this.field.filter((t=>t!==e&&t!==this.selectedItem)),this.field.push({x:this.selectedItem.x,y:this.selectedItem.y,id:t.result});break e}}this.selectedItem=null}}handleOnClick(e){this.handleClick(e)}handleOnTouch(e){this.handleClick(e.touches[0])}handleClick(e){const t=this.getPosition(e);console.log(t);for(let e of this.field)if(e.x<=t.x&&e.x+l>=t.x&&e.y<=t.y&&e.y+l>=t.y){this.selectedItem=e;break}}getPosition(e){const t=i.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}}([{first:"negative",second:"work",result:"money"},{first:"wind",second:"money",result:"tester"},{first:"money",second:"water",result:"pivko"},{first:"dm",second:"water",result:"dm_wet"},{first:"dm_wet",second:"wind",result:"dm_dead"},{first:"food",second:"work",result:"persimmon"},{first:"blob",second:"forest",result:"ants"},{first:"persimmon",second:"ants",result:"persimmon_with_ants"},{first:"work",second:"water",result:"forest"},{first:"cigarettes",second:"tester",result:"anton"},{first:"negative",second:"hat",result:"dm"},{first:"money",second:"pivko",result:"cigarettes"},{first:"dm_dead_six",second:"dm_dead_four",result:"portal"},{first:"dm_dead_eight",second:"dm_dead_two",result:"portal"},{first:"dm_dead",second:"dm_dead",result:"dm_dead_two"},{first:"dm_dead_two",second:"dm_dead_two",result:"dm_dead_four"},{first:"dm_dead_two",second:"dm_dead_four",result:"dm_dead_six"},{first:"dm_dead_six",second:"dm_dead_two",result:"dm_dead_eight"},{first:"dm_dead_four",second:"dm_dead_four",result:"dm_dead_eight"},{first:"forest",second:"negative",result:"wolf"},{first:"wolf",second:"wolf",result:"wolf_two"},{first:"wolf_two",second:"wolf_two",result:"wolf_four"},{first:"wolf_four",second:"dm",result:"wolfpack_1"},{first:"wolfpack_1",second:"anton_anteater",result:"wolfpack_2"},{first:"wolfpack_2",second:"il_blob",result:"wolfpack_3"},{first:"wolfpack_3",second:"ad",result:"wolfpack_4"},{first:"dark_fantasy",second:"universe",result:"victory"},{first:"anton",second:"persimmon_with_ants",result:"anton_anteater"},{first:"negative",second:"money",result:"online_prince"},{first:"money",second:"work",result:"blob"},{first:"blob",second:"lobster",result:"blobster"},{first:"forest",second:"water",result:"frog"},{first:"frog",second:"food",result:"lobster"},{first:"water",second:"frog",result:"il"},{first:"negative",second:"water",result:"hot_sause"},{first:"hot_sause",second:"dream",result:"nightmare_potion"},{first:"nightmare_potion",second:"il",result:"il_sleep"},{first:"il",second:"work",result:"dream"},{first:"il_sleep",second:"blobster",result:"il_blob"},{first:"blob",second:"money",result:"calculator"},{first:"calculator",second:"money",result:"minus"},{first:"pivko",second:"water",result:"beer"},{first:"beer",second:"minus",result:"beer_alkofree"},{first:"work",second:"minus",result:"1230"},{first:"work",second:"1230",result:"food"},{first:"forest",second:"wind",result:"plain"},{first:"plain",second:"water",result:"island"},{first:"island",second:"beer_alkofree",result:"gay_island"},{first:"gay_island",second:"food",result:"kal"},{first:"calculator",second:"online_prince",result:"calculator_prince"},{first:"calculator_prince",second:"portal",result:"ad"},{first:"negative",second:"wind",result:"hat"},{first:"forest",second:"food",result:"apple"},{first:"island",second:"food",result:"lemon"},{first:"lemon",second:"plain",result:"lemongrass"},{first:"lemongrass",second:"minus",result:"minus_lemongrass"},{first:"apple",second:"apple",result:"double_apple"},{first:"double_apple",second:"minus_lemongrass",result:"dust"},{first:"dust",second:"kal",result:"powered_kal"},{first:"powered_kal",second:"dm",result:"love"},{first:"love",second:"minus",result:"minus_love"},{first:"dm",second:"beer_alkofree",result:"dm_happy"},{first:"minus_love",second:"dm_happy",result:"dm_sad"},{first:"cross",second:"dm_sad",result:"crusader"},{first:"money",second:"money",result:"much_money"},{first:"much_money",second:"anton",result:"car"},{first:"car",second:"anton",result:"oval"},{first:"oval",second:"anton",result:"ovalolikiy"},{first:"ovalolikiy",second:"tire_keeper",result:"orden"},{first:"crusader",second:"tire",result:"tire_keeper"},{first:"mine",second:"hammer",result:"minecraft"},{first:"minecraft",second:"booblick",result:"evil"},{first:"car",second:"work",result:"underground_parking"},{first:"underground_parking",second:"negative",result:"booblick"},{first:"minus",second:"minus",result:"cross"},{first:"anton",second:"apple",result:"ogr"},{first:"police",second:"car",result:"penalty"},{first:"minus",second:"negative",result:"positive"},{first:"positive",second:"negative",result:"balance"},{first:"tulpa",second:"tea_goblin",result:"universe"},{first:"dm_dead",second:"buddha",result:"soul"},{first:"balance",second:"fingerprint",result:"buddha"},{first:"pivko",second:"anton",result:"police"},{first:"dm",second:"police",result:"fingerprint"},{first:"dm_with_tea",second:"ears",result:"tea_goblin"},{first:"hat",second:"island",result:"panama"},{first:"panama",second:"nagorny",result:"perm_pasport"},{first:"kal",second:"booblick",result:"cup"},{first:"cup",second:"water",result:"cup_of_water"},{first:"cup_of_tea",second:"cup_of_tea",result:"cups_of_tea"},{first:"cups_of_tea",second:"dm",result:"dm_with_tea"},{first:"dm",second:"pivko",result:"tea"},{first:"tea",second:"cup_of_water",result:"cup_of_tea"},{first:"mountains",second:"pivko",result:"nagorny"},{first:"perm_pasport",second:"anton",result:"ears"},{first:"work",second:"work",result:"real_work"},{first:"work",second:"hammer",result:"stones"},{first:"plain",second:"stones",result:"mountains"},{first:"dm",second:"real_work",result:"hammer"},{first:"booblick",second:"ears",result:"booblic_with_ears"},{first:"soul",second:"love",result:"tulpa"},{first:"pivko",second:"pchsp",result:"tavern"},{first:"mountains",second:"3-in-line",result:"mine"},{first:"orden",second:"mine",result:"castle"},{first:"hammer",second:"car",result:"tire"},{first:"penalty",second:"money",result:"few_money"},{first:"hammer",second:"apple",result:"mashed_apple"},{first:"mashed_apple",second:"food",result:"pie"},{first:"pie",second:"cup_of_tea",result:"tea_with_pie"},{first:"ears",second:"car",result:"music"},{first:"music",second:"few_money",result:"rep"},{first:"rep",second:"wolfpack_4",result:"rep_people"},{first:"rep_people",second:"3-7",result:"band"},{first:"band",second:"tea_with_pie",result:"pchsp"},{first:"calculator",second:"dm_dead_four",result:"4"},{first:"4",second:"cross",result:"4+"},{first:"4",second:"minus",result:"4-"},{first:"4-",second:"1",result:"3"},{first:"4+",second:"3",result:"7"},{first:"7",second:"7",result:"77"},{first:"77",second:"7",result:"3-7"},{first:"3",second:"3",result:"33"},{first:"33",second:"3",result:"3-in-line"},{first:"fantasy",second:"evil",result:"dark_fantasy"},{first:"tavern",second:"castle",result:"fantasy"},{first:"blob",second:"hammer",result:"1"}]);window.game=d,d.load([{x:200,y:400,id:"water"},{x:300,y:400,id:"wind"},{x:400,y:400,id:"negative"},{x:500,y:400,id:"work"}],new Set),function(e){const t=document.getElementById("save-button"),s=document.getElementById("load-button"),i="alchemy-save";s.disabled=!window.localStorage.getItem(i),t.onclick=function(){const t={fields:e.field,found:[...e.found]};window.localStorage.setItem(i,JSON.stringify(t)),s.disabled=!1},s.onclick=function(){const t=JSON.parse(window.localStorage.getItem(i)),s=t.fields,o=new Set(t.found);e.load(s,o)}}(d),document.getElementById("clear-button").onclick=()=>d.field=[]})();